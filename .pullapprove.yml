version: 3

pullapprove_conditions:
  - "'WIP' not in title"
  - "base.ref == 'staging'"
  - "'hotfix' not in labels"

notifications:
  - when: pull_request.opened
    comment: "The review is completed. @{{ author }}, please merge this in when ready."
#
#    comment: >
#      @{{ author }}, please make sure rubocop and the entire testsuite passes.

  - when: pullapprove.approved
    comment: "The review is completed. @{{ author }}, please merge this in when ready."

groups:
  compliance:
    conditions:
      - "'compliance' in labels"
    reviewers:
      teams: [ team-l2c2 ]
      users:
        - thorncp

  custody:
    conditions:
      - "'custody' in labels"
    reviewers:
      teams: [ team-l2c2 ]
      users:
        - jfedger

  indemnity:
    conditions:
      - "'indemnity' in labels"
    reviewers:
      teams: [ team-iris ]
      users:
        - jhakoopian

  issuance:
    conditions:
      - "'issuance' in labels"
    reviewers:
      teams: [ team-iris ]
      users:
        - JibranKalia

  ledger:
    conditions:
      - "'ledger' in labels"
    reviewers:
      teams: [ team-l2c2 ]
      users:
        - jfedger

  liquidity:
    conditions:
      - "'liquidity' in labels"
    reviews:
      required: 1
      request: 1
    reviewers:
      #teams: [ team-l2c2 ]
      users:
        - dollerbill

  other: # security, integrator/ dev experience, FA, internal tool/ backoffice
    conditions:
      - "'other' in labels"
    reviewers:
      teams: [ team-l2c2, team-iris ]

  rails:
    conditions:
      - "'rails' in labels"
    reviewers:
      teams: [ team-iris ]
      users:
        - JibranKalia

  settlement:
    conditions:
      - "'settlement' in labels"
    reviewers:
      teams: [ team-iris ]
      users:
        - ~davidzhangpt

#  dev:
#    reviewers:
#      users:
#        - username
#      teams:
#        - developers
#    reviews:
#      required: 2  # number of approvals required from this group
#      request: 1  # number of review requests sent at a time
#      request_order: random  # "random" or "given"
#    labels:
#      approved: "Code review approved"

####################
#### Team Leads ####
####################
# Each tech lead is set as their own group that will be tagged
# after their corresponding team has approved the initial reviews.
  liquidity_techlead:
    conditions:
      - len(pullapprove.approved) > 1
      - "'liquidity' in labels"
      - "'liquidity' in groups.passing"
#    labels:
#      approved: "Ready to merge"
    reviewers:
      users:
        - thorncp

  rails_techlead:
    conditions:
      - "'rails' in labels"
      - "'rails' in groups.passing"
    labels:
      approved: "Ready to merge"
    reviewers:
      users:
        - JibranKalia
